<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emoji Alchemy: Tycoon Edition</title>
    <style>
        :root { --bg: #050505; --accent: #ffcc00; --panel: rgba(20, 20, 20, 0.95); }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        canvas { position: absolute; top: 0; left: 0; pointer-events: none; }
        #header { z-index: 10; padding: 10px 20px; background: var(--panel); border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; }
        #board { flex-grow: 1; position: relative; z-index: 5; overflow: hidden; touch-action: none; }
        #inventory-container { z-index: 10; height: 30vh; background: var(--panel); border-top: 1px solid #444; display: flex; flex-direction: column; }
        #inventory { display: flex; flex-wrap: wrap; gap: 10px; padding: 15px; overflow-y: auto; justify-content: center; }
        .emoji { font-size: 2.5rem; cursor: grab; display: flex; flex-direction: column; align-items: center; width: 85px; user-select: none; position: relative; }
        .emoji-label { font-size: 0.65rem; color: #888; margin-top: 4px; text-align: center; pointer-events: none; }
        .on-board { position: absolute; z-index: 50; }
        .lvl-badge { position: absolute; top: -5px; right: 5px; font-size: 0.7rem; background: #7000ff; border-radius: 50%; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; color: white; }
        .money-text { color: #44ff44; font-weight: bold; font-family: monospace; font-size: 1.1rem; }
        #shop-modal, #admin-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #151515; border: 2px solid var(--accent); padding: 20px; z-index: 100; border-radius: 15px; text-align: center; min-width: 250px; max-height: 80vh; overflow-y: auto; }
        button { background: #222; border: 1px solid var(--accent); color: var(--accent); padding: 8px 15px; border-radius: 15px; cursor: pointer; font-weight: bold; margin: 2px; }
        input { background: #222; border: 1px solid #444; color: white; padding: 8px 15px; border-radius: 20px; width: 80%; margin: 10px auto; display: block; outline: none; }
        .admin-btn { background: #ff4444; color: white; border: none; }
    </style>
</head>
<body>

<canvas id="star-canvas"></canvas>
<canvas id="yellow-star-canvas"></canvas>

<div id="header">
    <div id="stats-bar">
        <div class="money-text">$<span id="money-display">0</span></div>
        <div style="font-size: 0.7rem; color: #888;">Rebirths: <span id="rebirth-display">0</span> | Found: <span id="found-count">0</span>/206</div>
    </div>
    <div style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: flex-end;">
        <button onclick="massMerge()" style="background: #7000ff; color: white; border: none;">‚ú® MERGE ALL</button>
        <button onclick="toggleShop()">ü™ô REBIRTH</button>
        <button onclick="clearBoard()">CLEAR</button>
        <button onclick="fullReset()" style="border-color: #ff4444; color: #ff4444;">RESET GAME</button>
    </div>
</div>

<div id="board"></div>

<div id="inventory-container">
    <input type="text" id="search" placeholder="Search items..." oninput="filterInventory()">
    <div id="inventory"></div>
</div>

<div id="shop-modal">
    <h3>Rebirth Shop</h3>
    <p>Cost: $100,000</p>
    <button onclick="attemptRebirth()">BUY REBIRTH</button>
    <button onclick="toggleShop()" style="border-color: #ff4444; color: #ff4444; margin-top: 10px;">CLOSE</button>
</div>

<div id="admin-modal">
    <h3 style="color: #ff4444;">Admin Panel</h3>
    <button class="admin-btn" onclick="money += 1000000; updateUI();">Add $1,000,000</button>
    <hr>
    <div id="admin-spawner-list" style="display: flex; flex-wrap: wrap; gap: 5px; justify-content: center;"></div>
    <button onclick="document.getElementById('admin-modal').style.display='none'" style="margin-top: 10px;">CLOSE (A)</button>
</div>

<script>
    let money = 0;
    let rebirths = 0;
    const REBIRTH_COST = 100000;

    // ... (Your massive recipes object goes here - keeping it as provided)
    const recipes = {
    "üî•+üåç": { result: "üåã", name: "Volcano", lvl: 2 },
    "üíß+üî•": { result: "üí®", name: "Steam", lvl: 2 },
    "üåç+üíß": { result: "üí©", name: "Mud", lvl: 2 },
    "üí®+üî•": { result: "‚ö°", name: "Energy", lvl: 2 },
    "üí®+üíß": { result: "üåßÔ∏è", name: "Rain", lvl: 2 },
    "üåßÔ∏è+üåç": { result: "üå±", name: "Plant", lvl: 2 },
    "üî•+üî•": { result: "‚òÄÔ∏è", name: "Sun", lvl: 2 },
    "üåç+üåç": { result: "üèîÔ∏è", name: "Mountain", lvl: 2 },
    "üí®+üí®": { result: "üå¨Ô∏è", name: "Wind", lvl: 2 },
    "üåã+üíß": { result: "ü™®", name: "Stone", lvl: 3 },
    "ü™®+üî•": { result: "‚õìÔ∏è", name: "Metal", lvl: 3 },
    "ü™®+üí®": { result: "üèñÔ∏è", name: "Sand", lvl: 3 },
    "üèñÔ∏è+üî•": { result: "üîÆ", name: "Glass", lvl: 3 },
    "üå±+‚òÄÔ∏è": { result: "üåª", name: "Flower", lvl: 3 },
    "üå±+üíß": { result: "üåø", name: "Herb", lvl: 3 },
    "üå±+üåç": { result: "üå≥", name: "Tree", lvl: 2 },
    "üå≥+üî•": { result: "ü™µ", name: "Wood", lvl: 3 },
    "ü™®+ü™®": { result: "üß±", name: "Brick", lvl: 3 },
    "üß±+üß±": { result: "üè†", name: "House", lvl: 4 },
    "üè†+üè†": { result: "üèòÔ∏è", name: "Village", lvl: 5 },
    "üèòÔ∏è+üèòÔ∏è": { result: "üèôÔ∏è", name: "City", lvl: 6 },
    "‚õìÔ∏è+ü™µ": { result: "üî®", name: "Hammer", lvl: 4 },
    "‚ö°+üîÆ": { result: "üí°", name: "Lightbulb", lvl: 4 },
    "‚õìÔ∏è+‚ö°": { result: "üîã", name: "Battery", lvl: 4 },
    "ü™µ+ü™®": { result: "üìè", name: "Ruler", lvl: 3 },
    "üå±+üåßÔ∏è": { result: "üìÑ", name: "Paper", lvl: 3 },
    "ü™®+üî®": { result: "‚úçÔ∏è", name: "Writing", lvl: 5 },
    "‚õìÔ∏è+‚õìÔ∏è": { result: "‚öôÔ∏è", name: "Gear", lvl: 4 },
    "‚öôÔ∏è+‚ö°": { result: "üöÇ", name: "Engine", lvl: 5 },
    "üöÇ+‚õìÔ∏è": { result: "üöú", name: "Machine", lvl: 6 },
    "‚ö°+üíß": { result: "üß™", name: "Life", lvl: 4 },
    "üß™+üåç": { result: "üêõ", name: "Bug", lvl: 5 },
    "üß™+üíß": { result: "üêü", name: "Fish", lvl: 5 },
    "üêõ+üå±": { result: "ü¶ã", name: "Butterfly", lvl: 6 },
    "üêü+üåç": { result: "ü¶é", name: "Reptile", lvl: 6 },
    "ü¶é+üî•": { result: "üêâ", name: "Dragon", lvl: 7 },
    "üß™+üß†": { result: "üß¨", name: "DNA", lvl: 6 },
    "üß¨+üåç": { result: "üêí", name: "Monkey", lvl: 7 },
    "üêí+üß†": { result: "üë®", name: "Human", lvl: 8 },
    "üë®+üî®": { result: "üë∑", name: "Worker", lvl: 9 },
    "üë®+‚úçÔ∏è": { result: "üßë‚Äçüè´", name: "Scholar", lvl: 9 },
    "üë®+üß™": { result: "üßõ", name: "Vampire", lvl: 9 },
    "üë®+ü¶¥": { result: "üíÄ", name: "Skeleton", lvl: 9 },
    "üíÄ+üß™": { result: "üßü", name: "Zombie", lvl: 10 },
    "üë®+üé®": { result: "üñºÔ∏è", name: "Art", lvl: 9 },
    "üîã+‚öôÔ∏è": { result: "üìü", name: "Transistor", lvl: 5 },
    "üìü+üìü": { result: "üíæ", name: "Microchip", lvl: 6 },
    "üíæ+üí°": { result: "üñ•Ô∏è", name: "Monitor", lvl: 7 },
    "üñ•Ô∏è+‚úçÔ∏è": { result: "‚å®Ô∏è", name: "Keyboard", lvl: 8 },
    "üñ•Ô∏è+‚å®Ô∏è": { result: "üíª", name: "Computer", lvl: 9 },
    "üíª+‚ö°": { result: "üåê", name: "Internet", lvl: 10 },
    "üåê+üß†": { result: "ü§ñ", name: "AI", lvl: 11 },
    "ü§ñ+üíª": { result: "ü¶æ", name: "Cyborg", lvl: 12 },
    "üíª+üéÆ": { result: "üïπÔ∏è", name: "Joystick", lvl: 10 },
    "üïπÔ∏è+üíª": { result: "üéÆ", name: "Video Game", lvl: 11 },
    "üåê+üë®": { result: "üìß", name: "Email", lvl: 11 },
    "üåê+üñºÔ∏è": { result: "üì∏", name: "Social Media", lvl: 11 },
    "üíª+‚õìÔ∏è": { result: "‚õèÔ∏è", name: "Bitcoin", lvl: 10 },
    "ü§ñ+‚öôÔ∏è": { result: "üè≠", name: "Automation", lvl: 12 },
    "ü§ñ+üë®": { result: "ü§ù", name: "Future", lvl: 13 },
    "‚òÄÔ∏è+‚òÄÔ∏è": { result: "üåü", name: "Star", lvl: 3 },
    "üåü+üåü": { result: "üåå", name: "Galaxy", lvl: 4 },
    "üåü+ü™®": { result: "üï≥Ô∏è", name: "Black Hole", lvl: 4 },
    "üï≥Ô∏è+üåç": { result: "‚è≥", name: "Time", lvl: 5 },
    "üöÇ+üöÄ": { result: "üöÄ", name: "Rocket", lvl: 6 },
    "üöÄ+üåç": { result: "üõ∞Ô∏è", name: "Satellite", lvl: 7 },
    "üõ∞Ô∏è+üåê": { result: "üì°", name: "Comms", lvl: 8 },
    "üöÄ+‚òÄÔ∏è": { result: "‚òÑÔ∏è", name: "Comet", lvl: 7 },
    "üöÄ+‚ö°": { result: "üõ∏", name: "UFO", lvl: 8 },
    "üõ∏+‚è≥": { result: "‚åõ", name: "Wormhole", lvl: 9 },
    "‚åõ+üåå": { result: "üåó", name: "Parallel Universe", lvl: 10 },
    "‚òÄÔ∏è+ü™®": { result: "ü™ê", name: "Planet", lvl: 4 },
    "ü™ê+üåä": { result: "üî±", name: "Atlantis", lvl: 5 },
    "ü™ê+üè†": { result: "üåë", name: "Moon Base", lvl: 5 },
    "üöÄ+üë®": { result: "üë®‚ÄçüöÄ", name: "Astronaut", lvl: 9 },
    "üî¨+üß™": { result: "‚öõÔ∏è", name: "Atom", lvl: 6 },
    "‚öõÔ∏è+‚ö°": { result: "üí•", name: "Nuclear Power", lvl: 7 },
    "‚öõÔ∏è+‚öõÔ∏è": { result: "üåë", name: "Dark Matter", lvl: 8 },
    "üåë+üí°": { result: "üî¶", name: "Antimatter", lvl: 9 },
    "‚åõ+‚öõÔ∏è": { result: "üï∞Ô∏è", name: "Quantum Time", lvl: 10 },
    "üíª+‚öõÔ∏è": { result: "üß™", name: "Quantum PC", lvl: 11 },
    "üß™+üß†": { result: "üß¨", name: "Telepathy", lvl: 12 },
    "üß¨+‚ö°": { result: "‚ö°", name: "Superpower", lvl: 13 },
    "üåå+‚öõÔ∏è": { result: "üåÄ", name: "Singularity", lvl: 14 },
    "üåÄ+üåç": { result: "üåã", name: "World Ender", lvl: 15 },
    "üí•+üöÄ": { result: "‚òÑÔ∏è", name: "Warp Drive", lvl: 14 },
    "üõ∞Ô∏è+üåë": { result: "üì°", name: "Deep Space", lvl: 15 },
    "üë®‚ÄçüöÄ+üõ∏": { result: "üëΩ", name: "Alien Contact", lvl: 15 },
    "üëΩ+üß™": { result: "üß¨", name: "Hybrid", lvl: 16 },
    "üß¨+ü§ñ": { result: "üß†", name: "Synthetic Life", lvl: 17 },
    "üîÆ+üí®": { result: "üßô", name: "Wizard", lvl: 7 },
    "üßô+üî•": { result: "ü™Ñ", name: "Magic Wand", lvl: 8 },
    "ü™Ñ+üêá": { result: "üé©", name: "Magic Trick", lvl: 9 },
    "üè∞+üõ°Ô∏è": { result: "‚öîÔ∏è", name: "Knight", lvl: 10 },
    "‚öîÔ∏è+üêâ": { result: "üíé", name: "Dragon Hoard", lvl: 11 },
    "‚ú®+üíç": { result: "üíç", name: "One Ring", lvl: 12 },
    "üßô+üìñ": { result: "üìú", name: "Spellbook", lvl: 13 },
    "üìú+‚ö°": { result: "‚ö°", name: "Lightning Bolt", lvl: 14 },
    "üìú+üíß": { result: "üåä", name: "Tsunami", lvl: 14 },
    "üßö+‚ú®": { result: "ü¶Ñ", name: "Unicorn", lvl: 15 },
    "ü¶Ñ+üåà": { result: "üç≠", name: "Candy Land", lvl: 16 },
    "üßô+üß™": { result: "üß™", name: "Potion", lvl: 17 },
    "üß™+üåô": { result: "üê∫", name: "Werewolf", lvl: 18 },
    "üåô+‚òÄÔ∏è": { result: "üåó", name: "Eclipse", lvl: 19 },
    "üåó+üîÆ": { result: "üßø", name: "Prophecy", lvl: 20 },
    "üåå+üß†": { result: "üîÆ", name: "Cosmic Mind", lvl: 21 },
    "üîÆ+üåü": { result: "‚ú®", name: "Celestial Forge", lvl: 22 },
    "‚ú®+üî®": { result: "üëë", name: "God Mode", lvl: 23 },
    "üëë+üï≥Ô∏è": { result: "üéÜ", name: "Big Bang", lvl: 24 },
    "üéÜ+‚è≥": { result: "‚ôæÔ∏è", name: "Infinity", lvl: 25 },
    "‚ôæÔ∏è+üåê": { result: "üéÆ", name: "The Simulation", lvl: 26 },
    "üéÆ+üëÅÔ∏è": { result: "üõë", name: "The Glitch", lvl: 27 },
    "üõë+üëë": { result: "‚ú®", name: "Ascension", lvl: 28 },
    "üèôÔ∏è+ü™ê": { result: "üè∞", name: "Galactic Empire", lvl: 29 },
    "üè∞+‚ôæÔ∏è": { result: "üåå", name: "Transcendence", lvl: 30 },
    "üß†+‚ú®": { result: "üëÅÔ∏è", name: "Enlightenment", lvl: 31 },
    "üëÅÔ∏è+‚ôæÔ∏è": { result: "üïâÔ∏è", name: "Nirvana", lvl: 32 },
    "üïâÔ∏è+üåà": { result: "üåà", name: "Pure Light", lvl: 33 },
    "üåà+üõë": { result: "‚ö™", name: "The End", lvl: 34 },
    "‚ö™+üë∂": { result: "üî•", name: "Rebirth", lvl: 1 },
    "üå±+üí©": { result: "üçÑ", name: "Mushroom", lvl: 2 },
    "üå≥+üêí": { result: "üçå", name: "Banana", lvl: 3 },
    "üíß+üêü": { result: "ü¶à", name: "Shark", lvl: 4 },
    "üåç+üêõ": { result: "üêç", name: "Snake", lvl: 3 },
    "‚òÄÔ∏è+ü¶ã": { result: "üêù", name: "Bee", lvl: 4 },
    "üêù+üåª": { result: "üçØ", name: "Honey", lvl: 5 },
    "üå∏+üå¨Ô∏è": { result: "üí®", name: "Pollen", lvl: 2 },
    "üèîÔ∏è+üêê": { result: "üèîÔ∏è", name: "Yeti", lvl: 6 },
    "ü¶¥+üêï": { result: "üêï", name: "Dog", lvl: 4 },
    "ü•õ+üê±": { result: "üê±", name: "Cat", lvl: 4 },
    "üå≥+üå≥": { result: "üå≤", name: "Forest", lvl: 3 },
    "üå≤+üî•": { result: "üí®", name: "Smoke", lvl: 2 },
    "üå±+üêù": { result: "üå∏", name: "Flower", lvl: 3 },
    "üåä+üêö": { result: "ü¶Ä", name: "Crab", lvl: 4 },
    "üêü+üê¶": { result: "üêß", name: "Penguin", lvl: 5 },
    "üêé+üåà": { result: "ü¶Ñ", name: "Unicorn", lvl: 6 },
    "ü¶Å+üèúÔ∏è": { result: "ü¶Å", name: "Lion", lvl: 5 },
    "üå≥+üçé": { result: "üçé", name: "Apple", lvl: 3 },
    "ü•ö+üî•": { result: "üê§", name: "Chick", lvl: 3 },
    "üê§+‚è≥": { result: "üêî", name: "Chicken", lvl: 4 },
    "üî•+üåæ": { result: "Bread", name: "Bread", lvl: 2 },
    "Bread+üßÄ": { result: "üçï", name: "Pizza", lvl: 4 },
    "üêÑ+‚ùÑÔ∏è": { result: "üç¶", name: "Ice Cream", lvl: 3 },
    "üî•+ü•©": { result: "üçî", name: "Burger", lvl: 4 },
    "ü•î+üî•": { result: "üçü", name: "Fries", lvl: 3 },
    "üçé+ü•ß": { result: "ü•ß", name: "Pie", lvl: 4 },
    "‚òï+üßä": { result: "ü•§", name: "Iced Coffee", lvl: 3 },
    "üçá+‚è≥": { result: "üç∑", name: "Wine", lvl: 5 },
    "üåæ+üç∫": { result: "üç∫", name: "Beer", lvl: 4 },
    "üç™+ü•õ": { result: "üç™", name: "Cookie", lvl: 3 },
    "üçû+ü•©": { result: "ü•™", name: "Sandwich", lvl: 4 },
    "üçÖ+ü•£": { result: "üç≤", name: "Soup", lvl: 3 },
    "üçö+üêü": { result: "üç£", name: "Sushi", lvl: 5 },
    "üç´+ü•õ": { result: "üç´", name: "Chocolate", lvl: 3 },
    "üçØ+üçã": { result: "üçµ", name: "Tea", lvl: 3 },
    "üåΩ+üî•": { result: "üçø", name: "Popcorn", lvl: 3 },
    "ü•î+üî™": { result: "ü•£", name: "Mashed Potato", lvl: 3 },
    "üçì+ü•õ": { result: "ü•§", name: "Smoothie", lvl: 4 },
    "üçó+üî•": { result: "üçó", name: "Fried Chicken", lvl: 4 },
    "ü•ö+üçû": { result: "üç≥", name: "French Toast", lvl: 4 },
    "ü™µ+‚õìÔ∏è": { result: "üé∏", name: "Guitar", lvl: 4 },
    "üé∏+‚ö°": { result: "ü§ò", name: "Rock", lvl: 5 },
    "üìÑ+üñäÔ∏è": { result: "üéº", name: "Sheet Music", lvl: 3 },
    "üéº+üìª": { result: "üéµ", name: "Melody", lvl: 4 },
    "üéµ+üë®": { result: "üé§", name: "Singer", lvl: 6 },
    "üé§+üíª": { result: "üéß", name: "Podcast", lvl: 5 },
    "üì∏+üéûÔ∏è": { result: "üé¨", name: "Movie", lvl: 5 },
    "üé¨+üçø": { result: "üìΩÔ∏è", name: "Cinema", lvl: 6 },
    "üé®+‚ö°": { result: "üì∫", name: "Television", lvl: 5 },
    "üì∫+üåê": { result: "üéûÔ∏è", name: "Streaming", lvl: 6 },
    "üìª+‚ö°": { result: "üéôÔ∏è", name: "Radio Station", lvl: 5 },
    "üéπ+üéº": { result: "üéª", name: "Orchestra", lvl: 7 },
    "üéÆ+üåê": { result: "üïπÔ∏è", name: "Esports", lvl: 8 },
    "üé¨+üë®": { result: "ü§µ", name: "Actor", lvl: 7 },
    "üé≠+üèõÔ∏è": { result: "üéüÔ∏è", name: "Theater", lvl: 6 },
    "üíÉ+üéµ": { result: "üï∫", name: "Party", lvl: 5 },
    "üé§+üî•": { result: "üî•", name: "Rap Battle", lvl: 6 },
    "üé®+üñåÔ∏è": { result: "üñºÔ∏è", name: "Masterpiece", lvl: 8 },
    "üì±+üì∏": { result: "ü§≥", name: "Influencer", lvl: 7 },
    "üÉè+üé©": { result: "ü™Ñ", name: "Magic Show", lvl: 6 },
    "üêé+ü™Ñ": { result: "ü¶Ñ", name: "Unicorn", lvl: 6 },
    "üî•+ü¶Ö": { result: "Phoenix", name: "Phoenix", lvl: 8 },
    "üî±+üåä": { result: "üßú‚Äç‚ôÄÔ∏è", name: "Mermaid", lvl: 7 },
    "üíÄ+üèπ": { result: "ü¶¥", name: "Skeleton Archer", lvl: 6 },
    "üèîÔ∏è+‚öíÔ∏è": { result: "üßî", name: "Dwarf", lvl: 6 },
    "üå≥+‚ú®": { result: "üßù", name: "Elf", lvl: 6 },
    "üåë+üßõ": { result: "ü¶á", name: "Bat", lvl: 5 },
    "üê∫+üåï": { result: "Werewolf", name: "Werewolf", lvl: 7 },
    "üêâ+ÂüéÂ†°": { result: "üëë", name: "Kingdom", lvl: 9 },
    "‚ö°+üî®": { result: "Thor", name: "Thor", lvl: 10 },
    "üåä+üêâ": { result: "üêç", name: "Kraken", lvl: 8 },
    "üî•+üêâ": { result: "üê≤", name: "Ancient Dragon", lvl: 11 },
    "üßô+üìñ": { result: "üìú", name: "Ancient Spell", lvl: 9 },
    "üèõÔ∏è+ü¶Å": { result: "ü¶Å", name: "Sphinx", lvl: 8 },
    "üëº+‚öîÔ∏è": { result: "üèπ", name: "Valkyrie", lvl: 10 },
    "üíÄ+üî•": { result: "üëπ", name: "Demon", lvl: 9 },
    "‚ú®+üíß": { result: " Fountain of Youth", name: "Fountain of Youth", lvl: 12 },
    "üßî+‚ö°": { result: "‚ö°", name: "Zeus", lvl: 15 },
    "üêç+üë©": { result: "üêç", name: "Medusa", lvl: 9 },
    "üëë+üèõÔ∏è": { result: "üèõÔ∏è", name: "Olympus", lvl: 20 }
};

    let unlocked = [
        { icon: "üî•", name: "Fire", lvl: 1 }, { icon: "üíß", name: "Water", lvl: 1 },
        { icon: "üåç", name: "Earth", lvl: 1 }, { icon: "üí®", name: "Air", lvl: 1 },
        { icon: "üß†", name: "Brain", lvl: 1 }, { icon: "üî®", name: "Hammer", lvl: 1 }
    ];

    const bgCanvas = document.getElementById('star-canvas');
    const starCanvas = document.getElementById('yellow-star-canvas');
    const bgCtx = bgCanvas.getContext('2d');
    const starCtx = starCanvas.getContext('2d');
    let bgStars = [], fallingStars = [];

    function initParticles() {
        bgCanvas.width = starCanvas.width = window.innerWidth;
        bgCanvas.height = starCanvas.height = window.innerHeight;
        bgStars = Array(100).fill().map(() => ({ x: Math.random()*bgCanvas.width, y: Math.random()*bgCanvas.height, s: Math.random()*2, o: Math.random() }));
        fallingStars = Array(20).fill().map(() => ({ x: Math.random()*starCanvas.width, y: Math.random()*-starCanvas.height, s: Math.random()*3+2, spd: Math.random()*2+1 }));
    }

    function animate() {
        bgCtx.clearRect(0,0,bgCanvas.width, bgCanvas.height);
        starCtx.clearRect(0,0,starCanvas.width, starCanvas.height);
        bgCtx.fillStyle = "white";
        bgStars.forEach(s => { bgCtx.globalAlpha = s.o; bgCtx.beginPath(); bgCtx.arc(s.x, s.y, s.s, 0, 7); bgCtx.fill(); });
        starCtx.fillStyle = "#ffcc00";
        fallingStars.forEach(s => {
            starCtx.beginPath(); starCtx.arc(s.x, s.y, s.s, 0, 7); starCtx.fill();
            s.y += s.spd; if(s.y > starCanvas.height) { s.y = -20; s.x = Math.random()*starCanvas.width; }
        });
        requestAnimationFrame(animate);
    }

    function processIncome() {
        let totalGain = 0;
        document.querySelectorAll('.on-board').forEach(el => {
            const lvl = parseInt(el.dataset.lvl) || 1;
            let gain = lvl * 10; // Simple tycoon formula
            totalGain += gain;
        });
        money += totalGain * (1 + rebirths);
        document.getElementById('money-display').innerText = Math.floor(money).toLocaleString();
    }

    function addItemToBoard(icon, name, lvl) {
        const el = document.createElement('div');
        el.className = 'emoji on-board';
        el.dataset.icon = icon;
        el.dataset.lvl = lvl;
        el.innerHTML = `${icon}${lvl > 1 ? `<span class="lvl-badge">${lvl}</span>` : ''}<span class="emoji-label">${name}</span>`;
        el.style.left = (20 + Math.random() * 50) + "%"; 
        el.style.top = (20 + Math.random() * 40) + "%";
        document.getElementById('board').appendChild(el);
        attachDrag(el);
    }

    function attachDrag(el) {
        let x = 0, y = 0, startX = 0, startY = 0;
        const onStart = (e) => {
            const touch = e.type === 'touchstart' ? e.touches[0] : e;
            startX = touch.clientX - x; startY = touch.clientY - y;
            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onEnd);
            document.addEventListener('touchmove', onMove, {passive: false});
            document.addEventListener('touchend', onEnd);
        };
        const onMove = (e) => {
            const touch = e.type === 'touchmove' ? e.touches[0] : e;
            x = touch.clientX - startX; y = touch.clientY - startY;
            el.style.transform = `translate(${x}px, ${y}px)`;
        };
        const onEnd = () => {
            document.removeEventListener('mousemove', onMove);
            document.removeEventListener('mouseup', onEnd);
            document.removeEventListener('touchmove', onMove);
            document.removeEventListener('touchend', onEnd);
            checkCollision(el);
        };
        el.addEventListener('mousedown', onStart);
        el.addEventListener('touchstart', onStart, {passive: false});
    }

    function checkCollision(el) {
        const r1 = el.getBoundingClientRect();
        document.querySelectorAll('.on-board').forEach(other => {
            if (other === el) return;
            const r2 = other.getBoundingClientRect();
            if (!(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom)) {
                const key1 = el.dataset.icon + "+" + other.dataset.icon;
                const key2 = other.dataset.icon + "+" + el.dataset.icon;
                const match = recipes[key1] || recipes[key2];
                if (match) {
                    addItemToBoard(match.result, match.name, match.lvl || 1);
                    if (!unlocked.find(u => u.icon === match.result)) {
                        unlocked.push({icon: match.result, name: match.name, lvl: match.lvl || 1});
                        updateUI();
                    }
                    el.remove(); other.remove();
                }
            }
        });
    }

    function updateUI() {
        const inv = document.getElementById('inventory');
        inv.innerHTML = '';
        unlocked.sort((a,b) => a.name.localeCompare(b.name)).forEach(item => {
            const div = document.createElement('div');
            div.className = 'emoji';
            div.innerHTML = `${item.icon}<span class="emoji-label">${item.name}</span>`;
            div.onclick = () => addItemToBoard(item.icon, item.name, item.lvl || 1);
            inv.appendChild(div);
        });
        document.getElementById('found-count').innerText = unlocked.length;
        document.getElementById('money-display').innerText = Math.floor(money).toLocaleString();
        document.getElementById('rebirth-display').innerText = rebirths;
    }

    // ADMIN FEATURES
    window.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'a') {
            const modal = document.getElementById('admin-modal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
            if(modal.style.display === 'block') populateAdminSpawner();
        }
    });

    function populateAdminSpawner() {
        const list = document.getElementById('admin-spawner-list');
        list.innerHTML = '';
        Object.values(recipes).forEach(item => {
            const btn = document.createElement('button');
            btn.innerHTML = item.result;
            btn.onclick = () => addItemToBoard(item.result, item.name, item.lvl);
            list.appendChild(btn);
        });
    }

    function massMerge() {
        const items = Array.from(document.querySelectorAll('.on-board'));
        let merged = false;
        for (let i = 0; i < items.length; i++) {
            for (let j = i + 1; j < items.length; j++) {
                const a = items[i]; const b = items[j];
                if (!a.parentElement || !b.parentElement) continue;
                const match = recipes[a.dataset.icon + "+" + b.dataset.icon] || recipes[b.dataset.icon + "+" + a.dataset.icon];
                if (match) {
                    addItemToBoard(match.result, match.name, match.lvl || 1);
                    if (!unlocked.find(u => u.icon === match.result)) {
                        unlocked.push({icon: match.result, name: match.name, lvl: match.lvl || 1});
                        updateUI();
                    }
                    a.remove(); b.remove(); merged = true; break;
                }
            }
            if (merged) break;
        }
        if (merged) massMerge();
    }

    function attemptRebirth() {
        if (money >= REBIRTH_COST) { money = 0; rebirths++; clearBoard(); toggleShop(); updateUI(); }
        else { alert("Need $100,000!"); }
    }

    function toggleShop() {
        const modal = document.getElementById('shop-modal');
        modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
    }

    function clearBoard() { document.getElementById('board').innerHTML = ''; }
    
    function filterInventory() {
        const val = document.getElementById('search').value.toLowerCase();
        document.querySelectorAll('#inventory .emoji').forEach(e => {
            e.style.display = e.innerText.toLowerCase().includes(val) ? 'flex' : 'none';
        });
    }

    window.addEventListener('resize', initParticles);
    initParticles(); 
    animate(); 
    updateUI(); 
    setInterval(processIncome, 1000);

        function fullReset() {
    if (confirm("Are you sure? This will delete all your items and money!")) {
        // Reset money and rebirths
        money = 0;
        rebirths = 0;

        // Reset the unlocked list to ONLY the starting items
        unlocked = [
            { icon: "üî•", name: "Fire", lvl: 1 }, 
            { icon: "üíß", name: "Water", lvl: 1 },
            { icon: "üåç", name: "Earth", lvl: 1 }, 
            { icon: "üí®", name: "Air", lvl: 1 },
            { icon: "üß†", name: "Brain", lvl: 1 }, 
            { icon: "üî®", name: "Hammer", lvl: 1 }
        ];

        // Clear everything off the board
        clearBoard();

        // Save the reset state to the browser
        localStorage.setItem('alchemy_save', JSON.stringify(unlocked));
        
        // Refresh the screen
        updateUI();
        alert("Game Reset Successfully!");
    }
}
</script>
</body>
</html>
